[å‰ç«¯ Nuxt3] é»é¸ç™»å…¥
â†“
[FastAPI] è½‰å‘ Google OAuth ç™»å…¥é 
â†“
[ä½¿ç”¨è€… Google ç™»å…¥ä¸¦æˆæ¬Š]
â†“
[FastAPI] æ”¶åˆ°æˆæ¬Šç¢¼ï¼Œå–å¾— Google ç”¨æˆ¶è³‡è¨Š
â†“
[FastAPI] ç°½ç™¼ JWT
â†“
[FastAPI] å°å‘å›å‰ç«¯ï¼Œä¸¦å¤¾å¸¶ JWT Token
â†“
[Nuxt3] å„²å­˜ Token ä¸¦é¡¯ç¤ºç”¨æˆ¶è³‡è¨Š

âœ… ç¬¬ä¸€æ­¥ï¼šGoogle Cloud è¨­å®š
å»ºç«‹å°ˆæ¡ˆä¸¦å•Ÿç”¨ OAuth åŒæ„ç•«é¢

å»ºç«‹æ†‘è­‰ï¼šOAuth ç”¨æˆ¶ç«¯ ID

è¨­å®š redirect URI â†’ http://localhost:8000/auth/google/callback

è¨˜ä¸‹ï¼š

Client ID

Client Secret

âœ… ç¬¬äºŒæ­¥ï¼šFastAPI å¾Œç«¯æ•´åˆ Google + JWT
ğŸ“ æª”æ¡ˆçµæ§‹å»ºè­°
bash
è¤‡è£½
ç·¨è¼¯
backend/
â”œâ”€â”€ main.py
â”œâ”€â”€ auth.py
â”œâ”€â”€ jwt_utils.py
â”œâ”€â”€ .env
ğŸ“„ .env
ini
è¤‡è£½
ç·¨è¼¯
GOOGLE_CLIENT_ID=ä½ çš„client_id
GOOGLE_CLIENT_SECRET=ä½ çš„client_secret
JWT_SECRET=è¶…å¼·çš„ç§˜å¯†å­—ä¸²
FRONTEND_URL=http://localhost:3000
ğŸ“„ jwt_utils.py
python
è¤‡è£½
ç·¨è¼¯
import jwt
from datetime import datetime, timedelta

JWT_SECRET = "your_jwt_secret" # å¯¦éš›ä¸Šå¾ç’°å¢ƒè®Šæ•¸è®€å–

def create_jwt(data: dict, expires_minutes=60):
payload = {
\*\*data,
"exp": datetime.utcnow() + timedelta(minutes=expires_minutes),
"iat": datetime.utcnow()
}
token = jwt.encode(payload, JWT_SECRET, algorithm="HS256")
return token

def decode_jwt(token: str):
try:
return jwt.decode(token, JWT_SECRET, algorithms=["HS256"])
except jwt.ExpiredSignatureError:
return None
except jwt.InvalidTokenError:
return None
ğŸ“„ auth.py
python
è¤‡è£½
ç·¨è¼¯
from fastapi import APIRouter, Request
from starlette.responses import RedirectResponse
import os
import requests
from jwt_utils import create_jwt
from urllib.parse import urlencode

router = APIRouter()

GOOGLE_CLIENT_ID = os.environ["GOOGLE_CLIENT_ID"]
GOOGLE_CLIENT_SECRET = os.environ["GOOGLE_CLIENT_SECRET"]
REDIRECT_URI = "http://localhost:8000/auth/google/callback"
FRONTEND_URL = os.environ.get("FRONTEND_URL", "http://localhost:3000")

@router.get("/auth/google")
async def google_login():
params = {
"client_id": GOOGLE_CLIENT_ID,
"redirect_uri": REDIRECT_URI,
"response_type": "code",
"scope": "openid email profile",
"access_type": "offline",
"prompt": "consent"
}
return RedirectResponse(f"https://accounts.google.com/o/oauth2/v2/auth?{urlencode(params)}")

@router.get("/auth/google/callback")
async def google_callback(request: Request):
code = request.query_params.get("code")

    # äº¤æ›æˆæ¬Šç¢¼ç‚º token
    token_resp = requests.post("https://oauth2.googleapis.com/token", data={
        "code": code,
        "client_id": GOOGLE_CLIENT_ID,
        "client_secret": GOOGLE_CLIENT_SECRET,
        "redirect_uri": REDIRECT_URI,
        "grant_type": "authorization_code"
    })
    token_json = token_resp.json()
    access_token = token_json.get("access_token")

    # å–å¾—ä½¿ç”¨è€…è³‡è¨Š
    user_info = requests.get("https://www.googleapis.com/oauth2/v3/userinfo", headers={
        "Authorization": f"Bearer {access_token}"
    }).json()

    jwt_token = create_jwt({
        "email": user_info["email"],
        "name": user_info["name"],
        "picture": user_info.get("picture", "")
    })

    # å°å‘å›å‰ç«¯ä¸¦é™„å¸¶ JWT
    return RedirectResponse(f"{FRONTEND_URL}/auth/callback?token={jwt_token}")

ğŸ“„ main.py
python
è¤‡è£½
ç·¨è¼¯
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from auth import router as auth_router

app = FastAPI()

app.add_middleware(
CORSMiddleware,
allow_origins=["http://localhost:3000"],
allow_credentials=True,
allow_methods=["*"],
allow_headers=["*"],
)

app.include_router(auth_router)
âœ… ç¬¬ä¸‰æ­¥ï¼šNuxt3 å‰ç«¯æ•´åˆæµç¨‹
ğŸ“„ pages/login.vue
vue
<template>

  <div class="min-h-screen flex justify-center items-center">
    <button
      class="px-6 py-3 bg-red-500 text-white rounded"
      @click="redirectToGoogle"
    >
      ä½¿ç”¨ Google ç™»å…¥
    </button>
  </div>
</template>

<script setup lang="ts">
const config = useRuntimeConfig()

function redirectToGoogle() {
  window.location.href = `${config.public.BaseUrl}/auth/google`
}
</script>

ğŸ“„ pages/auth/callback.vue
vue
è¤‡è£½
ç·¨è¼¯

<script setup lang="ts">
import { useRouter, useRoute } from 'vue-router'
import { useAuth } from '~/composables/useAuth'

const route = useRoute()
const router = useRouter()
const { user, isLoggedIn } = useAuth()

const token = route.query.token as string
if (token) {
  // ä½ å¯ä»¥å­˜åœ¨ localStorage æˆ– cookie
  localStorage.setItem('token', token)

  // å¯ä»¥è‡ªè¡Œ decode token
  const payload = JSON.parse(atob(token.split('.')[1]))
  user.value = payload
  isLoggedIn.value = true

  alert('ğŸ‰ æ­¡è¿ ' + payload.name)

  router.push('/')
} else {
  alert('ç™»å…¥å¤±æ•—')
  router.push('/login')
}
</script>

ğŸ“„ composables/useAuth.ts
ts
è¤‡è£½
ç·¨è¼¯
export const useAuth = () => {
const user = useState<any>('user', () => null)
const isLoggedIn = useState('isLoggedIn', () => false)
return { user, isLoggedIn }
}
